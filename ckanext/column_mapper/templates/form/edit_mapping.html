{% extends "page.html" %}
{% set data = data or {} %}
{% set errors = errors or {} %}

{% set action = form_action or h.url_for(c.link) %}
{% block primary_content %}

<form id="resource-edit" class="dataset-form dataset-resource-form form-horizontal" method="post" action="{{ action }}" data-module="basic-form resource-form" enctype="multipart/form-data">
<p>
<div data-module="custom-fields">

<div class="row-fluid" style="text-align:center;font-weight:bold;">
        <div class="span3">Original Name</div>
        <div class="span3">Truncated Name</div>
        <div class="span3">Format</div>
</div>

  {%if c.pkg_data_dictionary%}
	  {% set data_dict = c.pkg_data_dictionary %}
	  {% set data_dict = data_dict + [[][],[],[],[],[],[]]%}
  {%else%}
	{%set data_dict = [[],[],[],[],[],[],[],[],[],[],[],[]]%}
  {%endif%}
  {% for extra in data_dict %}
    {% set index = loop.index0 + (extras|count) %}
    {% if data_dict[index] %}
    {% set current_data_dict = data_dict[index] %}
    {% else %}
    {% set current_data_dict = {'original_name' :'','mapped_name' :'', 'column_type': ''} %}
    {%endif%}

    <div class="control-group control-custom" style="margin:1px;">
    <div class="row-fluid">

     <div class="span3"><input id="field-{{ index }}" type="text" name="field_{{ index }}" value="{{current_data_dict['original_name']}}" style="width:90%" /></div>
      <div class="span3"><input id="title-{{ index }}" type="text" name="title_{{ index }}" value="{{current_data_dict['mapped_name']}}" style="width:90%" /></div>
      <div class="span3">
	<select class="span20" name="format_{{index}}">
		<option value=""></option>
			<option value="timestamp" {% if current_data_dict['column_type'] == "timestamp" %} selected {% endif %}>timestamp</option>
            <option value="numeric" {% if current_data_dict['column_type'] == "numeric" %} selected {% endif %}>numeric</option>
            <option value="text" {% if current_data_dict['column_type'] == "text" %} selected {% endif %}>text</option>
	</select>
      </div>
      <div class=""><input id="id-{{ index }}" type="hidden" name="id_{{ index }}" value="{{current_data_dict['id']}}" /></div>

        <!--<label class="checkbox" for="{{ 'remove-%d' % index }}">
          <input type="checkbox" id="{{ 'remove-%d' % index }}" name="{{ 'remove_%d' % index }}" />
        </label>-->
   </div>
    </div>
  {% endfor %}

</div>
</p>

{% block data_dict_buttons %}
{% if c.pkg %}
{% snippet 'form/form_cancel_button.html', extras=data.extras, errors=errors, pkg_name=pkg_name, limit=(c.pkg_data_dictionary|length)+1 %}
{% else %}
{% snippet 'form/form_save_button.html', extras=data.extras, errors=errors, limit=3 %}
{%endif%}
{% endblock %}

</form>
{% endblock %}
